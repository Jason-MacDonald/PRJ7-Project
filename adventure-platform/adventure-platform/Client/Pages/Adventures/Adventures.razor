@page "/adventures"

@inject IAdventureRepository adventureRepository

<AdventureFilter OnSubmit="FilterAdventures" />

<AdventureList Adventures="adventures" ContextString="@contextString" />

@if (numPages > 1)
{
    <Pagination CurrentPage="@adventureFilterDTO.Page" NumPages="numPages" SelectPage="SelectPage" />
}

@code {

    #region ##### HEAD #####
    private const string contextString = "adventures";

    private AdventureFilterDTO adventureFilterDTO = new AdventureFilterDTO();
    private List<Adventure> adventures;
    private int numPages; // Returned from paginatedResponse calculation;

    #endregion

    #region ##### LIFE CYCLE METHODS #####

    protected async override Task OnInitializedAsync()
    {
        await SelectPage(1);
    }

    #endregion

    #region ##### CALLBACK METHODS #####

    private async Task SelectPage(int page)
    {
        adventureFilterDTO.Page = page;

        try
        {
            await FilterAdventures(adventureFilterDTO);
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }

    public async Task FilterAdventures(AdventureFilterDTO prAdventureFilterDTO)
    {
        adventureFilterDTO = prAdventureFilterDTO;

        var paginatedResponse = await adventureRepository.GetFilteredAdventures(adventureFilterDTO);
        adventures = paginatedResponse.Response;
        numPages = paginatedResponse.NumPages;
    }

    #endregion

}
